<!DOCTYPE html>
<html lang="{{ lang }}">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>{{ meta_title }}</title>
    <meta name="description" content="{{ meta_desc }}">
    <link rel="canonical" href="{{ canonical }}">
    {% for link in hreflangs %}
    <link rel="alternate" hreflang="{{ link.hreflang }}" href="{{ link.href }}">
    {% endfor %}
    <meta property="og:title" content="{{ meta_title }}">
    <meta property="og:description" content="{{ meta_desc }}">
    <meta property="og:url" content="{{ og_url }}">
    <meta property="og:type" content="article">
    <meta property="og:image" content="{{ og_image }}">
    <meta property="og:image:alt" content="{{ meta_title }}">
    <meta property="og:image:width" content="1200">
    <meta property="og:image:height" content="630">
    <link rel="icon" type="image/svg+xml" href="/static/favicon 32x32 main.svg">
    {% include "partials/analytics.html" %}
    <link href="https://fonts.googleapis.com/css2?family=Montserrat:wght@400;500;600;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" href="/static/css/header.css">
    <link rel="stylesheet" href="/static/css/company.css">
    <link rel="stylesheet" href="/static/css/searchbar.css">
    <link rel="stylesheet" href="/static/css/footer.css">
<link rel="stylesheet" href="/static/css/company_claim/base.css">
<link rel="stylesheet" href="/static/css/company_claim/step3.css">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.0/build/css/intlTelInput.css">
    <script>
        (function() {
            const saved = localStorage.getItem('theme');
            const theme = (saved === 'light' || saved === 'dark') ? saved : 
                         (window.matchMedia('(prefers-color-scheme: dark)').matches ? 'dark' : 'light');
            document.documentElement.setAttribute('data-theme', theme);
        })();
    </script>
    <style>
        @keyframes spin {
            to { transform: rotate(360deg); }
        }
    </style>
    {% if company_jsonld %}
    <script type="application/ld+json">
    {{ company_jsonld | tojson }}
    </script>
    {% endif %}
</head>
<body>
    {% include "partials/header.html" %}
    <div class="company-page">
        <div class="hero">
            <h1 class="hero-title">{{ t.list_title }}</h1>
            <p class="hero-subtitle">{{ t.list_subtitle }}</p>
        </div>

        {% set placeholder = t.search_placeholder %}
        {% set button_text = t.search_button %}
        {% set input_id = "searchInputCompany" %}
        {% set button_id = "searchButtonCompany" %}
        {% set button_onclick = "window.location.href='/" ~ (lang if lang else 'ru') ~ "/reviews'" %}
        {% include "partials/search_bar.html" with context %}

        <div class="actions">
            <a class="btn back-btn" href="/{{ lang }}/reviews">
                <span class="icon">
                    <svg width="15" height="12" viewBox="0 0 15 12" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.243989 6.14691C0.0877627 5.99063 0 5.77871 0 5.55774C0 5.33677 0.0877627 5.12485 0.243989 4.96857L4.95816 0.254407C5.03503 0.174815 5.12698 0.11133 5.22865 0.0676557C5.33032 0.0239816 5.43967 0.000992977 5.55032 3.14637e-05C5.66097 -0.00093005 5.7707 0.0201549 5.87312 0.0620557C5.97553 0.103956 6.06857 0.165834 6.14682 0.244078C6.22506 0.322322 6.28694 0.415365 6.32884 0.517778C6.37074 0.620192 6.39183 0.729925 6.39086 0.840575C6.3899 0.951224 6.36691 1.06057 6.32324 1.16224C6.27957 1.26391 6.21608 1.35587 6.13649 1.43274L2.84482 4.72441H13.8807C14.1017 4.72441 14.3136 4.8122 14.4699 4.96848C14.6262 5.12477 14.714 5.33673 14.714 5.55774C14.714 5.77875 14.6262 5.99072 14.4699 6.147C14.3136 6.30328 14.1017 6.39107 13.8807 6.39107H2.84482L6.13649 9.68274C6.28829 9.83991 6.37228 10.0504 6.37038 10.2689C6.36848 10.4874 6.28084 10.6964 6.12634 10.8509C5.97183 11.0054 5.76282 11.0931 5.54432 11.095C5.32583 11.0969 5.11532 11.0129 4.95816 10.8611L0.243989 6.14691Z" fill="#012AF9"/>
                    </svg>
                </span>
                {{ t.back_button }}
            </a>
        </div>

        <div class="company-top-row">
        <div class="company-card">
                <div class="company-avatar">
                    {% if owner_data and owner_data.photo %}
                    <img src="{{ owner_data.photo }}" alt="Логотип компании">
                    {% else %}
                    <svg width="21" height="17" viewBox="0 0 21 17" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M17.185 8.70567C17.3514 8.70567 17.4907 8.64967 17.6027 8.53767C17.7147 8.42567 17.7703 8.28722 17.7695 8.12233C17.7687 7.95744 17.7127 7.81861 17.6015 7.70583C17.4903 7.59306 17.3518 7.53745 17.1862 7.539H13.5963C13.4307 7.539 13.2918 7.59461 13.1798 7.70583C13.0686 7.81706 13.013 7.95589 13.013 8.12233C13.013 8.28878 13.0686 8.42722 13.1798 8.53767C13.2911 8.64811 13.4299 8.70411 13.5963 8.70567H17.185ZM17.185 5.474C17.3514 5.474 17.4907 5.41839 17.6027 5.30717C17.7147 5.19594 17.7703 5.05711 17.7695 4.89067C17.7687 4.72422 17.7127 4.58578 17.6015 4.47533C17.4903 4.36489 17.3518 4.30889 17.1862 4.30733H13.5963C13.4307 4.30733 13.2918 4.36294 13.1798 4.47417C13.0686 4.58617 13.013 4.725 13.013 4.89067C13.013 5.05633 13.0686 5.19517 13.1798 5.30717C13.2911 5.41917 13.4299 5.47478 13.5963 5.474H17.185ZM7.08983 9.69267C6.44972 9.69267 5.90761 9.737 5.4635 9.82567C5.01861 9.91433 4.62 10.0574 4.26767 10.255C3.96433 10.4183 3.73528 10.5968 3.5805 10.7905C3.42572 10.9842 3.34872 11.1911 3.3495 11.4112C3.3495 11.5846 3.41833 11.7304 3.556 11.8487C3.69367 11.9669 3.86633 12.026 4.074 12.026H10.1057C10.3133 12.026 10.486 11.9618 10.6237 11.8335C10.7613 11.7052 10.8302 11.5523 10.8302 11.375C10.8302 11.179 10.7567 10.9888 10.6097 10.8045C10.4627 10.6202 10.2301 10.4374 9.912 10.2562C9.55889 10.0578 9.16028 9.91433 8.71617 9.82567C8.27205 9.737 7.72994 9.69267 7.08983 9.69267ZM7.08983 7.80733C7.58217 7.80733 7.99672 7.63894 8.3335 7.30217C8.67105 6.96461 8.83983 6.54967 8.83983 6.05733C8.83983 5.565 8.67105 5.15045 8.3335 4.81367C7.99594 4.47689 7.58139 4.30811 7.08983 4.30733C6.59828 4.30656 6.18372 4.47533 5.84617 4.81367C5.50861 5.152 5.33983 5.56656 5.33983 6.05733C5.33983 6.54811 5.50861 6.96306 5.84617 7.30217C6.18372 7.64128 6.59828 7.80967 7.08983 7.80733ZM1.88533 16.3333C1.34789 16.3333 0.8995 16.1537 0.540167 15.7943C0.180833 15.435 0.000777778 14.9862 0 14.448V1.88533C0 1.34789 0.180056 0.8995 0.540167 0.540166C0.900278 0.180833 1.34828 0.000777778 1.88417 0H19.1158C19.6525 0 20.1005 0.180055 20.4598 0.540166C20.8192 0.900278 20.9992 1.34867 21 1.88533V14.4492C21 14.9858 20.8199 15.4342 20.4598 15.7943C20.0997 16.1544 19.6517 16.3341 19.1158 16.3333H1.88533ZM1.88533 15.1667H19.1158C19.2947 15.1667 19.4592 15.092 19.6093 14.9427C19.7594 14.7933 19.8341 14.6284 19.8333 14.448V1.88533C19.8333 1.70567 19.7587 1.54078 19.6093 1.39067C19.46 1.24056 19.2955 1.16589 19.1158 1.16667H1.88417C1.70528 1.16667 1.54078 1.24133 1.39067 1.39067C1.24056 1.54 1.16589 1.70489 1.16667 1.88533V14.4492C1.16667 14.6281 1.24133 14.7926 1.39067 14.9427C1.54 15.0928 1.7045 15.1674 1.88417 15.1667" fill="#0D0D0D"/>
                    </svg>
                    {% endif %}
                </div>
            <div class="company-info">
                <div class="company-name">{{ display_name }}</div>
                    {% if total_reviews > 0 %}
                <div class="company-meta">{{ t.total_reviews }}: {{ total_reviews }}</div>
                    {% endif %}
                </div>
            </div>

            <div class="actions dual">
                {% if not is_claimed %}
                <button class="btn ghost" id="myCompanyBtn" type="button">
                    {{ t.my_company_button }}
                </button>
                {% endif %}
                <a class="btn solid" href="/{{ lang }}/reviews/item/{{ company_id }}?page=1#add-review">
                    {{ t.add_review_button }}
                </a>
            </div>
        </div>

        {% if company_sections %}
        <div class="company-accordion">
            <button class="accordion-header" type="button" id="company-info-toggle">
                <span>{{ t.company_info_title }}</span>
                <svg class="accordion-arrow" width="16" height="10" viewBox="0 0 16 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                    <path d="M1 1.5L8 8.5L15 1.5" stroke="#012AF9" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"/>
                </svg>
            </button>
            <div class="accordion-content" id="company-info-content">
                <div class="company-meta-card">
                    <div class="meta-columns">
                        <div class="meta-column">
                            {% for section in company_sections[:2] %}
                            <div class="meta-section">
                                <div class="section-title">{{ section.title }}</div>
                                <div class="section-line"></div>
                                {% for item in section.rows %}
                                <div class="meta-row">
                                    <div class="meta-label">{{ item.label }}:</div>
                                    <div class="meta-value">{{ item.value }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endfor %}
                        </div>

                        <div class="meta-column">
                            {% for section in company_sections[2:4] %}
                            <div class="meta-section">
                                <div class="section-title">{{ section.title }}</div>
                                <div class="section-line"></div>
                                {% for item in section.rows %}
                                <div class="meta-row">
                                    <div class="meta-label">{{ item.label }}:</div>
                                    <div class="meta-value">{{ item.value }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endfor %}
                        </div>

                        <div class="meta-column">
                            {% for section in company_sections[4:] %}
                            <div class="meta-section">
                                <div class="section-title">{{ section.title }}</div>
                                <div class="section-line"></div>
                                {% for item in section.rows %}
                                <div class="meta-row">
                                    <div class="meta-label">{{ item.label }}:</div>
                                    <div class="meta-value">{{ item.value }}</div>
                                </div>
                                {% endfor %}
                            </div>
                            {% endfor %}
                        </div>
                    </div>
                </div>
            </div>
        </div>
        {% endif %}

        <div class="reviews">
            {% for review in reviews %}
            <div class="review-card">
                <div class="review-top">
                    <div class="review-source">{{ review.source }}</div>
                    <div class="review-stars-row">
                        <div class="review-stars">
                            {% for i in range(1,6) %}
                                {% if review.rating >= i %}
                                <span class="star filled">★</span>
                                {% else %}
                                <span class="star">☆</span>
                                {% endif %}
                            {% endfor %}
                        </div>
                        <div class="review-rating-number">{{ "%.1f"|format(review.rating) }}</div>
                    </div>
                </div>

                <div class="review-title-date">
                    <div class="review-title">{{ review.subject or display_name }}</div>
                    <div class="review-date">{{ review.date }}</div>
                </div>

                <div class="review-from-row">
                    <div class="review-from-label">{{ t.from_label }}</div>
                    <div class="review-author">
                        {% if review.reviewer_id %}
                        <a href="/{{ lang }}/reviews/item/{{ review.reviewer_id }}" class="review-author-link">
                            {{ review.reviewer }}
                            <span class="link-loader" style="display: none; margin-left: 8px; width: 16px; height: 16px; border: 2px solid #012AF9; border-top-color: transparent; border-radius: 50%; animation: spin 0.6s linear infinite; vertical-align: middle;"></span>
                        </a>
                        {% else %}
                        {{ review.reviewer }}
                        {% endif %}
                    </div>
                </div>

                <div class="review-bubble">{{ review.comment }}</div>
            </div>
            {% endfor %}
        </div>

        <div class="pagination">
            <div class="pagination-buttons">
            {% if page > 1 %}
                <a href="?page={{ page - 1 }}" class="pagination-button">
                    <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5.25 0.75L1.25 4.75L5.25 8.75" stroke="#A3A3A3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </a>
            {% else %}
                <span class="pagination-button pagination-button-disabled">
                    <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M5.25 0.75L1.25 4.75L5.25 8.75" stroke="#A3A3A3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </span>
            {% endif %}

            <span class="page-info">{{ t.page_label }} {{ page }} / {{ total_pages }}</span>

            {% if page < total_pages %}
                <a href="?page={{ page + 1 }}" class="pagination-button">
                    <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.75 0.75L4.75 4.75L0.75 8.75" stroke="#A3A3A3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </a>
            {% else %}
                <span class="pagination-button pagination-button-disabled">
                    <svg width="6" height="10" viewBox="0 0 6 10" fill="none" xmlns="http://www.w3.org/2000/svg">
                        <path d="M0.75 0.75L4.75 4.75L0.75 8.75" stroke="#A3A3A3" stroke-width="1.5" stroke-linecap="round" stroke-linejoin="round"/>
                    </svg>
                </span>
            {% endif %}
            </div>
        </div>
    </div>

    <!-- Модальное окно для подтверждения компании -->
    <div id="companyClaimData" data-company-id="{{ company_id }}" style="display: none;"></div>
    {% include "partials/company_claim_modal.html" %}
</body>
<script src="https://cdn.jsdelivr.net/npm/intl-tel-input@23.0.0/build/js/intlTelInput.min.js"></script>
<script src="/static/js/header.js"></script>
<script src="/static/js/search_bar.js"></script>
<script src="/static/js/company_claim/step1.js"></script>
<script src="/static/js/company_claim/step2.js"></script>
<script src="/static/js/company_claim/step3.js"></script>
<script src="/static/js/company_claim/index.js"></script>
<script>
    document.addEventListener('DOMContentLoaded', function() {
        window.initSearchBar({
            inputId: 'searchInputCompany',
            buttonId: 'searchButtonCompany',
            basePath: '/{{ lang }}/reviews',
            emptyText: '{{ t.empty_results }}'
        });

        const accordion = document.querySelector('.company-accordion');
        const accordionHeader = document.getElementById('company-info-toggle');
        if (accordion && accordionHeader) {
            accordion.classList.remove('open'); // старт: свернуто
            accordionHeader.addEventListener('click', function () {
                accordion.classList.toggle('open');
            });
        }

        // Показываем лоадер при клике на ссылку компании
        document.querySelectorAll('.review-author-link').forEach(function(link) {
            link.addEventListener('click', function(e) {
                const loader = this.querySelector('.link-loader');
                if (loader) {
                    e.preventDefault(); // Предотвращаем переход
                    loader.style.display = 'inline-block';
                    const href = this.href;
                    // Даём время на отрисовку лоадера, потом переходим
                    setTimeout(function() {
                        window.location.href = href;
                    }, 50);
                }
            });
        });
    });
</script>
{% include "partials/footer.html" %}
</body>
</html>

